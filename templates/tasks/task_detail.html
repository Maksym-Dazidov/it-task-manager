{% extends "base.html" %}
{% block title %}{{ task.name }}{% endblock %}

{% block content %}
  <div class="d-flex justify-content-between mb-3">
    <h2>{{ task.name }}</h2>
    <div>
      <a href="{% url 'tasks:task-update' task.pk %}" class="btn btn-warning btn-sm">Edit</a>
      <a href="{% url 'tasks:task-delete' task.pk %}" class="btn btn-danger btn-sm">Delete</a>
    </div>
  </div>

  <p class="text-muted">{{ task.description }}</p>

  <ul class="list-group mb-3">
    <li class="list-group-item"><strong>Type:</strong> {{ task.task_type.name }}</li>
    <li class="list-group-item">
      <strong>Priority:</strong>
      <span class="badge priority-{{ task.priority }}">
            {{ task.get_priority_display }}
        </span>
    </li>
    <li class="list-group-item">
      <strong>Status:</strong>
      {% if task.is_completed %}
        <span class="badge bg-success">Completed</span>
      {% else %}
        <span class="badge bg-warning text-dark">In progress</span>
      {% endif %}
    </li>
    <li class="list-group-item">
      <strong>Deadline:</strong>
      {{ task.deadline|date:"Y-m-d H:i"|default:"â€”" }}
    </li>
  </ul>

  <h5>ğŸ‘¥ Assignees</h5>
  {% if not task.is_completed %}
    <form method="post"
          action="{% url 'tasks:task-toggle-assign' task.pk %}"
          class="mt-3">
      {% csrf_token %}

      {% if user in task.assignees.all %}
        <button type="submit" class="btn btn-outline-danger">
          âŒ Leave task
        </button>
      {% else %}
        <button type="submit" class="btn btn-outline-success">
          â• Join task
        </button>
      {% endif %}
    </form>
  {% endif %}
  <ul>
    {% for user in task.assignees.all %}
      <li>{{ user.username }} ({{ user.position }})</li>
    {% empty %}
      <li>No assignees</li>
    {% endfor %}
  </ul>

  <h5>ğŸ· Tags</h5>
  {% for tag in task.tags.all %}
    <span class="badge bg-secondary">{{ tag.name }}</span>
  {% empty %}
    <p>No tags</p>
  {% endfor %}
{% endblock %}
